{% extends 'base.html' %}
{% load forms_extras %}

{% block title %}Settings Â· Ledgerly{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-purple-50 dark:from-gray-900 dark:via-gray-900 dark:to-gray-800 transition-all duration-300 flex items-start justify-center p-4">
  <div class="w-full max-w-5xl space-y-8 animate-slide-in-up">
    <!-- Page Header -->
    <header class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-gradient-primary rounded-lg flex items-center justify-center">
          <i class="fas fa-cog text-white text-lg"></i>
        </div>
        <div>
          <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">General Settings</h1>
          <p class="text-gray-500 dark:text-gray-400 text-sm">Manage your profile, password, and account lifecycle</p>
        </div>
      </div>
      <a href="{% url 'daily_view_today' %}" class="px-4 py-2 rounded-lg bg-white/70 dark:bg-gray-800/70 hover:bg-white dark:hover:bg-gray-800 border border-white/30 dark:border-gray-700/50 text-gray-800 dark:text-gray-100 font-medium transition-colors duration-200">
        <i class="fas fa-arrow-left mr-2"></i>Back to Ledger
      </a>
    </header>

    <!-- Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Profile (left) -->
      <section class="lg:col-span-2 bg-white/70 dark:bg-gray-800/70 backdrop-blur-md p-6 rounded-2xl shadow-2xl border border-white/30 dark:border-gray-700/50">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-lg flex items-center justify-center">
            <i class="fas fa-user text-white text-sm"></i>
          </div>
          <h2 class="text-xl font-bold">Profile Settings</h2>
        </div>
        <form method="post" class="space-y-4">
          {% csrf_token %}
          <input type="hidden" name="action" value="update_profile" />
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm text-gray-600 dark:text-gray-300 mb-1">Username</label>
              {{ profile_form.username|add_class:"w-full px-3 py-2 rounded-lg bg-gray-50 dark:bg-gray-700 border border-gray-300/50 dark:border-gray-600/50" }}
              {% if profile_form.username.errors %}
              <p class="text-red-500 text-xs mt-1">{{ profile_form.username.errors|striptags }}</p>
              {% endif %}
            </div>
            <div>
              <label class="block text-sm text-gray-600 dark:text-gray-300 mb-1">Email</label>
              {{ profile_form.email|add_class:"w-full px-3 py-2 rounded-lg bg-gray-50 dark:bg-gray-700 border border-gray-300/50 dark:border-gray-600/50" }}
              {% if profile_form.email.errors %}
              <p class="text-red-500 text-xs mt-1">{{ profile_form.email.errors|striptags }}</p>
              {% endif %}
            </div>
            <div>
              <label class="block text-sm text-gray-600 dark:text-gray-300 mb-1">First name</label>
              {{ profile_form.first_name|add_class:"w-full px-3 py-2 rounded-lg bg-gray-50 dark:bg-gray-700 border border-gray-300/50 dark:border-gray-600/50" }}
            </div>
            <div>
              <label class="block text-sm text-gray-600 dark:text-gray-300 mb-1">Last name</label>
              {{ profile_form.last_name|add_class:"w-full px-3 py-2 rounded-lg bg-gray-50 dark:bg-gray-700 border border-gray-300/50 dark:border-gray-600/50" }}
            </div>
          </div>
          <div class="pt-2">
            <button type="submit" class="px-5 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-purple-600 hover:to-blue-600 text-white font-semibold rounded-xl transition-all duration-300 hover:scale-105 hover:shadow-lg">
              <i class="fas fa-save mr-2"></i>Save Changes
            </button>
          </div>
        </form>
      </section>

      <!-- Change Password (below left) -->
      <section class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-md p-6 rounded-2xl shadow-2xl border border-white/30 dark:border-gray-700/50">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-8 h-8 bg-gradient-to-r from-green-500 to-emerald-500 rounded-lg flex items-center justify-center">
            <i class="fas fa-key text-white text-sm"></i>
          </div>
          <h2 class="text-xl font-bold">Change Password</h2>
        </div>
         <form method="post" class="space-y-3">
          {% csrf_token %}
          <input type="hidden" name="action" value="change_password" />
          {% for field in password_form %}
          <div>
            <label class="block text-sm text-gray-600 dark:text-gray-300 mb-1">{{ field.label }}</label>
            {{ field|add_class:"w-full px-3 py-2 rounded-lg bg-gray-50 dark:bg-gray-700 border border-gray-300/50 dark:border-gray-600/50" }}
            {% if field.errors %}
            <p class="text-red-500 text-xs mt-1">{{ field.errors|striptags }}</p>
            {% endif %}
          </div>
          {% endfor %}
           <button type="submit" class="w-full bg-gradient-to-r from-green-500 to-emerald-500 hover:from-emerald-500 hover:to-green-500 text-white font-semibold py-3 rounded-xl transition-all duration-300 hover:scale-105 hover:shadow-lg">
            <i class="fas fa-lock mr-2"></i>Update Password
          </button>
        </form>
        </section>

      <!-- Danger Zone (below right) -->
      <section class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-md p-6 rounded-2xl shadow-2xl border border-white/30 dark:border-gray-700/50">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-8 h-8 bg-gradient-to-r from-red-500 to-pink-500 rounded-lg flex items-center justify-center">
            <i class="fas fa-exclamation-triangle text-white text-sm"></i>
          </div>
          <h2 class="text-xl font-bold text-red-600 dark:text-red-400">Danger Zone</h2>
        </div>
        <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">This will permanently delete your account and all associated data.</p>
          <form method="post" class="space-y-3">
          {% csrf_token %}
          <input type="hidden" name="action" value="delete_account" />
          <div>
            <label class="block text-sm text-gray-600 dark:text-gray-300 mb-1">Type DELETE to confirm</label>
            {{ deletion_form.confirm_text|add_class:"w-full px-3 py-2 rounded-lg bg-gray-50 dark:bg-gray-700 border border-gray-300/50 dark:border-gray-600/50" }}
            {% if deletion_form.confirm_text.errors %}
            <p class="text-red-500 text-xs mt-1">{{ deletion_form.confirm_text.errors|striptags }}</p>
            {% endif %}
          </div>
          <div>
            <label class="block text-sm text-gray-600 dark:text-gray-300 mb-1">Current password</label>
            {{ deletion_form.password|add_class:"w-full px-3 py-2 rounded-lg bg-gray-50 dark:bg-gray-700 border border-gray-300/50 dark:border-gray-600/50" }}
            {% if deletion_form.password.errors %}
            <p class="text-red-500 text-xs mt-1">{{ deletion_form.password.errors|striptags }}</p>
            {% endif %}
          </div>
            <button type="submit" class="delete-account-btn w-full flex items-center justify-center gap-2 text-white font-semibold py-3 rounded-xl transition-all duration-200 hover:scale-[1.03] shadow-lg">
             <i class="fas fa-trash"></i>
              <span>Delete Account</span>
            </button>
        </form>
        </section>
    </div>
  </div>
</div>

{% endblock %}


